#!/bin/zsh

set -x

# TODO default directory

scriptPath=$(realpath "$(dirname "$0")") 
repoPath="${scriptPath}/.."

mkdir -p ~/.local/share/applications
mkdir -p ~/.local/bin
mkdir -p ~/.gnupg
mkdir -p ~/.config/dunst

ln -sf ${repoPath}/applications/*.desktop -t ~/.local/share/applications
ln -sf ${repoPath}/bin/*                  -t ~/.local/bin
ln -sf ${repoPath}/gnupg/*                -t ~/.gnupg
ln -sf ${repoPath}/nvim                   -t ~/.config
ln -sf ${repoPath}/zsh                    -t ~/.config
ln -sf ${repoPath}/tmux/.*                -t ~
ln -sf ${repoPath}/xorg/.xinitrc          -t ~
ln -sf ${repoPath}/xorg/.Xresources       -t ~
ln -sf ${repoPath}/xorg/dunstrc           -t ~/.config/dunst

sudo ln -sf ${repoPath}/xorg/30-touchpad.conf -t /etc/X11/xorg.conf.d
sudo ln -sf ${repoPath}/xorg/20-intel.conf    -t /etc/X11/xorg.conf.d

link_runsvdir() {
	setopt dotglob
	${3} mkdir -p ${2}

	for sv in ${repoPath}/runit/${1}/*; do 
		svName=$(basename "${sv}")
		svDir=${2}/${svName}

		${3} mkdir -p ${svDir}
		${3} ln -sf ${sv}/* -t ${svDir}
	done
	unsetopt dotglob
}

link_runsvdir user-service ~/.config/service
link_runsvdir x-service    ~/.config/x-service
link_runsvdir service      /etc/sv sudo
