#!/bin/zsh

set -x

# TODO default directory

scriptPath=$(realpath "$(dirname "$0")") 
repoPath="${scriptPath}/.."

for app in ${repoPath}/applications/*; do 
	trash ~/.local/share/applications/$(basename ${app})
done

for script in ${repoPath}/bin; do 
	trash ~/.local/bin/$(basename ${config})
done

for config in ${repoPath}/gnupg/*; do 
	trash ~/.gnupg/$(basename ${config})
done

for config in ${repoPath}/tmux/.*; do 
	trash ~/$(basename ${config})
done

for sv in ${repoPath}/runit/service/*; do 
	containsRun=$(ls -1 ${sv}/run 2>/dev/null | wc -l)

	# If we have a run script then we drop the whole service 
	# otherwise we only clean up
	if [ ${containsRun} -eq 1 ]; then 
		sudo rm -rf /etc/sv/$(basename ${sv})
	else 
		setopt dotglob
		for svFile in ${sv}/*; do 
			sudo rm -rf /etc/sv/$(basename ${sv})/${svFile}
		done
		unsetopt dotglob
	fi 
done

trash ~/.config/nvim
trash ~/.config/zsh
trash ~/.xinitrc
trash ~/.Xresources
trash ~/.config/dunst
trash ~/.config/service
trash ~/.config/x-service
trash ~/.zshenv

sudo rm -f  /etc/X11/xorg.conf.d/30-touchpad.conf
sudo rm -f  /etc/X11/xorg.conf.d/20-intel.conf
sudo rm -f  /etc/default/efibootmgr-kernel-hook
sudo rm -rf /etc/connman

for config in ${repoPath}/kernel.d/*; do 
	sudo rm -f /etc/kernel.d/post-install/$(basename ${config})
done
