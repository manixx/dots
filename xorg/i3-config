# Globals 

set $white   #c5cdd9
set $black   #2c2e34
set $grey    #88909f
set $red     #ec7279
set $green   #a0c980
set $cyan    #5dbbc1
set $yellow  #deb974
set $blue    #6cb6eb
set $magenta #d38aea

set $font        DejaVu Sans
set $font_weight Bold
set $font_size   8

set $mod   Mod4
set $up    k
set $down  j
set $left  h
set $right l

set $ws-test      "0:&#xf683;"
set $ws-code      "1:&#xf121;"
set $ws-browse    "2:&#xf57d;"
set $ws-term      "3:&#xf120;"
set $ws-messaging "4:&#xf086;"
set $ws-music     "5:&#xf025;"

set $ws-test-key      dead_circumflex
set $ws-code-key      1
set $ws-browse-key    2
set $ws-term-key      3
set $ws-messaging-key 4
set $ws-music-key     5

# General commands  

font              pango:$font $font_weight $font_size
floating_modifier $mod

bindsym $mod+Return            exec --no-startup-id st -n st
bindsym $mod+Shift+Return      exec --no-startup-id st -n st-temp
bindsym $mod+Escape            exec --no-startup-id ~/.bin/lock-screen
bindsym $mod+Shift+a           exec --no-startup-id ~/.bin/autostart
bindsym $mod+Shift+q           kill
bindsym $mod+BackSpace         reload
bindsym $mod+Shift+BackSpace   restart
bindsym $mod+Shift+x 					 exec --no-startup-id ~/.bin/toggle-xautolock
bindsym $mod+Shift+r           exec --no-startup-id ~/.bin/toggle-redshift

bindsym Shift+XF86Display exec --no-startup-id ~/.config/xrandr/reset
bindsym XF86Display       exec --no-startup-id \
	script=$(fd --base-directory ~/.config/xrandr | dmenu -i -p display -fn '$font-$font_size' -nf '$grey' -nb '$black' -sf '$black' -sb '$white') && \
	sh ~/.config/xrandr/$script && sh ~/.fehbg 

bindsym $mod+space exec --no-startup-id i3-dmenu-desktop \
  --dmenu="dmenu -i -p run -b -fn '$font-$font_size' -nf '$grey' -nb '$black' -sf '$black' -sb '$white'" 

bindsym $mod+p exec --no-startup-id passmenu \
  -i -l 5 -fn '$font-$font_size' -nf '$grey' -nb '$black' -sf '$black' -sb '$white'

bindsym $mod+Shift+Escape exec \
  "i3-nagbar --font 'pango:$font $font_size' -t warning -m 'Exit?' -B 'Okay' 'i3-msg exit'"

bindsym --release $mod+Print exec --no-startup-id scrot -s 

# Multimedia Keys

bindsym XF86AudioMute        exec --no-startup-id pactl set-sink-mute   0 toggle
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume 0 -5%
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume 0 +5%
bindsym XF86AudioMicMute     exec --no-startup-id pactl set-source-mute 1 toggle

bindsym XF86MonBrightnessDown exec --no-startup-id xbacklight -dec 10 && \
  xbacklight -get | cut -d'.' -f 1 > /home/manfred/.cache/backlight
bindsym XF86MonBrightnessUp   exec --no-startup-id xbacklight -inc 10 && \
  xbacklight -get | cut -d'.' -f 1 > /home/manfred/.cache/backlight
bindsym Shift+XF86MonBrightnessDown exec --no-startup-id xbacklight -dec 5 && \
  xbacklight -get | cut -d'.' -f 1 > /home/manfred/.cache/backlight
bindsym Shift+XF86MonBrightnessUp   exec --no-startup-id xbacklight -inc 5 && \
  xbacklight -get | cut -d'.' -f 1 > /home/manfred/.cache/backlight

# Spotify 

bindsym $mod+XF86AudioMute        exec --no-startup-id \
  dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause

bindsym $mod+XF86AudioLowerVolume exec --no-startup-id \
  dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Previous

bindsym $mod+XF86AudioRaiseVolume exec --no-startup-id \
  dbus-send --print-reply --dest=org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Next

bindsym $mod+Shift+s exec --no-startup-id \
	"pkill -x spotify; gtk-launch spotify"

# Movement 

bindsym $mod+$left  focus left
bindsym $mod+$down  focus down
bindsym $mod+$up    focus up
bindsym $mod+$right focus right

bindsym $mod+Shift+$left  move left
bindsym $mod+Shift+$down  move down
bindsym $mod+Shift+$up    move up
bindsym $mod+Shift+$right move right

# Layout 

bindsym $mod+c split h
bindsym $mod+v split v
bindsym $mod+f fullscreen toggle

bindsym $mod+w layout tabbed
bindsym $mod+s layout toggle split

bindsym $mod+a focus parent
bindsym $mod+y focus child

bindsym $mod+Shift+f     floating toggle
bindsym $mod+Shift+space sticky toggle

bindsym $mod+Shift+minus move scratchpad
bindsym $mod+minus       scratchpad show

bindsym $mod+d   focus     mode_toggle
bindsym $mod+Tab workspace back_and_forth

# Workspaces 

bindsym $mod+$ws-test-key      workspace $ws-test
bindsym $mod+$ws-code-key      workspace $ws-code
bindsym $mod+$ws-browse-key    workspace $ws-browse
bindsym $mod+$ws-term-key      workspace $ws-term
bindsym $mod+$ws-messaging-key workspace $ws-messaging
bindsym $mod+$ws-music-key     workspace $ws-music

bindsym $mod+Shift+$ws-test-key      move container to workspace $ws-test
bindsym $mod+Shift+$ws-code-key      move container to workspace $ws-code
bindsym $mod+Shift+$ws-browse-key    move container to workspace $ws-browse
bindsym $mod+Shift+$ws-term-key      move container to workspace $ws-term
bindsym $mod+Shift+$ws-messaging-key move container to workspace $ws-messaging
bindsym $mod+Shift+$ws-music-key     move container to workspace $ws-music

# Resize 

mode "resize" {
  bindsym $left       resize shrink width  10 px or 10 ppt
  bindsym $down       resize grow   height 10 px or 10 ppt
  bindsym $up         resize shrink height 10 px or 10 ppt
  bindsym $right      resize grow   width  10 px or 10 ppt

	bindsym v exec \
		i3-msg floating enable && \
		i3-msg resize set width 500 px height 281 px && \
		i3-msg sticky enable && \
		i3-msg move position mouse

  bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# Move workspaces

mode "move ws" {
  bindsym 1 move workspace to output eDP1
  bindsym 2 move workspace to output DP1
  bindsym 3 move workspace to output DP2
  bindsym 4 move workspace to output HDMI1
  bindsym 5 move workspace to output HDMI2
  bindsym Escape mode "default" 
}
bindsym $mod+m mode "move ws" 

# Assign workspaces to screens 

workspace $ws-test      output eDP1
workspace $ws-code      output DP2 
workspace $ws-browse    output HDMI2
workspace $ws-term      output eDP1
workspace $ws-messaging output eDP1
workspace $ws-music     output eDP1

# Styling 

gaps              inner 9
smart_gaps        on
hide_edge_borders smart
title_align       center

for_window [class=".*"] border pixel 1

#                       border bg     text   indic. child_border
client.focused          $white $white $black $blue  $white
client.focused_inactive $black $black $grey  $black $black
client.unfocused        $black $black $grey  $black $black
client.urgent           $black $black $red   $black $black
client.placeholder      $black $black $white $black $black
client.background       $black

# Bar 

bar {
  status_command          i3status
  i3bar_command           i3bar 
  position                top
  tray_output             none
  strip_workspace_numbers yes

	mode hide
	hidden_state hide
	modifier $mod

  colors {
    background $black
    statusline $white
    separator  $grey

    #	                 border bground text
    focused_workspace  $black $black  $magenta
    active_workspace   $black $black  $grey
    inactive_workspace $black $black  $grey
    urgent_workspace   $black $black  $red
    binding_mode       $black $yellow $black
  }
}

# Application assginments 

assign [instance="^nvim$"]             $ws-code
assign [instance="^st$"]               $ws-term
assign [instance="^chromium$"]         $ws-browse
assign [instance="^Navigator$"]        $ws-browse # firefox
assign [instance="^youtube.com$"]      $ws-music
assign [instance="^netflix.com$"]      $ws-music
assign [instance="^atv.at$"]           $ws-music
assign [instance="^spotify-tui"]       $ws-music
assign [instance="^web.whatsapp.com$"] $ws-messaging
assign [instance="^matterhorn$"]       $ws-messaging
assign [instance="^talk.sclable.com$"] $ws-messaging
assign [instance="^telegram-desktop$"] $ws-messaging
assign [instance="^insomnia$"]         $ws-test

for_window [instance="^spotify$"]   move to workspace $ws-music
for_window [instance="^st$"]        focus
for_window [instance="^chromium$"]  focus
for_window [instance="^nvim$"]      focus
for_window [instance="^Navigator$"] focus
for_window [instance="^insomnia$"]  focus

for_window [title="^DevTools"]      move to workspace $ws-test # chromium dev tools

# Autostart 

exec --no-startup-id ~/.fehbg
exec --no-startup-id ~/.bin/toggle-redshift
exec --no-startup-id ~/.bin/toggle-xautolock

exec --no-startup-id pgrep -x unclutter || unclutter --timeout 1
exec --no-startup-id pgrep -x dunst     || dunst
