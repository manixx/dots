#!/bin/zsh

command=$1

pre_actions() {
	# Check if nvim is open, maybe it has unsaved stuff. Notify user and skip
	# shutdown.
	if pgrep -x nvim; then
		notify-send -u critical "Session $command stopped" "Neovim may has unsaved work, close it before."
		exit 0
	fi

	killall chromium --wait
	sudo user-poweroff
}

if [ -z "$command" ]; then
	echo "Usage: session [poweroff|zzz|ZZZ]"
	exit 1
fi

case $command in
	poweroff)
		pre_actions
		sudo poweroff
	;;
	*)
		echo "session command $command not found."
esac

